@page "/"
@using System.ComponentModel;
@implements IDisposable
@inject Heater Heater

@code {
    protected override void OnInitialized()
    {
        Heater.PropertyChanged += StateChangedHandler;
    }

    public void Dispose()
    {
        Heater.PropertyChanged -= StateChangedHandler;
    }

    void StateChangedHandler(object? sender, PropertyChangedEventArgs e)
    {
        InvokeAsync(StateHasChanged);
    }

    IList<HeaterMode> HeaterModes = new[] { HeaterMode.Schedule, HeaterMode.Override, HeaterMode.Off };

    int SelectedHeaterModeIndex
    {
        get => HeaterModes.IndexOf(Heater.Mode);
        set => Heater.Mode = HeaterModes[value];
    }
}

<PageTitle>Index</PageTitle>

<MudGrid>
    <MudItem xs="12">
    </MudItem>

    <MudItem xs="12">
        <FlameAnimation IsOn=@(Heater.Mode != HeaterMode.Off) />
    </MudItem>

    <MudItem xs="12">
        <MudTabs Outlined="true" Centered="true" MinimumTabWidth="130px" Rounded="true"
                 @bind-ActivePanelIndex="SelectedHeaterModeIndex">
            @foreach (var mode in HeaterModes)
            {
                <MudTabPanel Text="@(mode.ToString())" />
            }
        </MudTabs>
    </MudItem>

    <MudItem xs="12">
        <HeaterLevelEditor />
    </MudItem>
</MudGrid>